<!DOCTYPE HTML>
<html lang="en" class="rust" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Cheat Sheets</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('rust')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="git-cheat-sheet.html"><strong aria-hidden="true">1.</strong> git cheat sheet</a></li><li class="chapter-item expanded "><a href="one-liners.html"><strong aria-hidden="true">2.</strong> One-Liners</a></li><li class="chapter-item expanded "><a href="gcloud-cli.html"><strong aria-hidden="true">3.</strong> gcloud - Google Cloud CLI</a></li><li class="chapter-item expanded "><a href="docker-cli.html"><strong aria-hidden="true">4.</strong> docker CLI</a></li><li class="chapter-item expanded "><a href="k8s.html"><strong aria-hidden="true">5.</strong> Kubernetes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="k8s/kubectl-and-api.html"><strong aria-hidden="true">5.1.</strong> kubectl and API</a></li><li class="chapter-item expanded "><a href="k8s/labels-selectors-annotations.html"><strong aria-hidden="true">5.2.</strong> Labels, Selectors, Annotations</a></li></ol></li><li class="chapter-item expanded "><a href="concourse-ci.html"><strong aria-hidden="true">6.</strong> Concourse-CI</a></li><li class="chapter-item expanded "><a href="vault.html"><strong aria-hidden="true">7.</strong> Vault</a></li><li class="chapter-item expanded "><a href="mac-keyboard-shortcuts-etc.html"><strong aria-hidden="true">8.</strong> Mac keyboard shortcuts</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Cheat Sheets</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <p><a href="https://walquis.github.io/git-basics-team-project/cheat-sheet.html">Git Cheat Sheet from git basics class</a></p>
<div style="break-before: page; page-break-before: always;"></div><p>One-liners (or few-liners) I use, but not enough to remember. </p>
<h2 id="find-a-process-listening-on-a-port"><a class="header" href="#find-a-process-listening-on-a-port">Find a process listening on a port</a></h2>
<p>On a Mac, usually because I want to kill it. From <a href="https://www.btaz.com/mac-os-x/find-the-process-listening-to-port-on-mac-os-x/">find-the-process-listening-to-port-on-mac-os-x/</a>.</p>
<pre><code>$ lsof -nP -iTCP -sTCP:LISTEN | grep 8080
</code></pre>
<h2 id="linux-date-commands"><a class="header" href="#linux-date-commands">Linux date commands</a></h2>
<pre><code>$ date +%s
1447428499
$ date -d @1447428499  # Or on Mac, date -r 1447428499
Fri Nov 13 09:28:19 CST 2015
$ date
Fri Nov 13 09:28:35 CST 2015
$ date -d &quot;Thu Nov 12 17:30:00 CST 2015&quot;  # On Mac, something else
Thu Nov 12 17:30:00 CST 2015
$ date -d &quot;Thu Nov 12 17:30:00 CST 2015&quot; +%s
1447371000
# On Mac...
$ date -j -f &quot;%Y-%m-%d %H:%M&quot; &quot;2015-11-12 17:30&quot; +%s    
1447371052

# Or use https://www.epochconverter.com/
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="gcloud"><a class="header" href="#gcloud">gcloud</a></h2>
<h3 id="install-gcloud"><a class="header" href="#install-gcloud">Install gcloud</a></h3>
<pre><code>$ brew install --cask google-cloud-sdk            
$ gcloud components install gke-gcloud-auth-plugin
$ gcloud init
</code></pre>
<h3 id="create-a-cluster"><a class="header" href="#create-a-cluster">Create a cluster</a></h3>
<pre><code>$ gcloud container clusters create my-cluster
</code></pre>
<p>Update ~/.kube/config to point kubectl at a specific cluster in GKE.</p>
<pre><code>$ gcloud container clusters get-credentials my-cluster
</code></pre>
<p>Example of building an image tagged for pushing to my Google container registry repo</p>
<pre><code>$ docker build -t us-east1-docker.pkg.dev/k8s-cluster-learning-393915/bg-hw-deploy-refimpl/app-image:1.2.10 .
</code></pre>
<h3 id="use-gcloud-to-set-up-google-container-registry-repo-for-docker-images"><a class="header" href="#use-gcloud-to-set-up-google-container-registry-repo-for-docker-images">Use gcloud to set up Google container registry repo for Docker images</a></h3>
<pre><code>$ gcloud services enable artifactregistry.googleapis.com

# Create the repo...
$ gcloud artifacts repositories create bg-hw-deploy-refimpl --repository-format=docker --description=&quot;blue/green helloworld app&quot; --location=us-east1

# Use gcloud to add a credential helper to your ~/.docker/config.json...
$ gcloud auth configure-docker us-east1-docker.pkg.dev

# Now you can 'docker push' the tagged image...
$ docker push us-east1-docker.pkg.dev/k8s-cluster-learning-393915/bg-hw-deploy-refimpl/app-image

</code></pre>
<p>Set up some gcloud defaults to make subsequent commands easier...</p>
<pre><code>$ gcloud config set artifacts/location us-east1 
$ gcloud config set artifacts/repository bg-hw-deploy-refimpl

# These were already set during 'gcloud init' ...
$ gcloud config get compute/region
us-east1
$ gcloud config get compute/zone  
us-east1-b
</code></pre>
<p>Stop the cluster nodes (e.g., to minimize ongoing charges)</p>
<pre><code>gcloud container clusters resize my-cluster --num-nodes=0
</code></pre>
<p>Delete the cluster</p>
<pre><code>gcloud container clusters delete my-cluster
</code></pre>
<p>Look at the pushed image...</p>
<pre><code>$ gcloud artifacts docker images list

</code></pre>
<p>kubectl looking-around commands...</p>
<pre><code>$ kubectl get pods
$ kubectl get namespaces
$ kubectl config current-context
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="docker"><a class="header" href="#docker">Docker</a></h2>
<pre><code>alias d=docker  # Save typing

d inspect the-image-name-or-ID | jq '.[].Config.Cmd'
d image ls
d ps
</code></pre>
<p>Managing storage:</p>
<pre><code>d history &lt;image&gt;
d system df

d image prune # clears images w/o tags (dangling images)
d builder prune # clears image build cache

d manifest inspect &lt;image&gt;  # on a remote registry only--not local
d inspect &lt;container&gt; | jq '.[].Config'
</code></pre>
<p>Other stuff:</p>
<pre><code>d commit &lt;container&gt; &lt;new-image-name&gt;  # Snapshot a running container to an image

d volume create demo1 # Persistent volumes
</code></pre>
<p>Building and running; SSH'ing into a running container</p>
<pre><code>$ d build --progress=plain -t tt .
$ d run -p 3000:3000 -it tt  # run the container
$ d run -p 3000:3000 -it tt /bin/bash  # Debug the container; overrides the Dockerfile's CMD or ENTRYPOINT directive
$ d exec -it $(docker ps | tail -1 | rev | cut -d'\'' '\'' -f1 | rev) /bin/bash' # SSH into the first running container
</code></pre>
<p>Build and tag an image at the same time, and publish to Artifactory, with a git sha as an image tag...</p>
<pre><code>image_tag=`git rev-parse --short HEAD`
docker_tag=&lt;company-artifactory-url&gt;/apprenticeship-docker-local-default/bg-hw-deploy-refimpl:$image_tag
d build -t $docker_tag .
d push $docker_tag
</code></pre>
<p>The following command helped me debug an <code>exec format error</code> issue for a pod trying to start a container from my image; it showed that my <code>helloworld</code> image was an <code>arm64</code> image.</p>
<pre><code>d inspect helloworld | grep -i arch
</code></pre>
<p>I needed to tell Docker on my M2 mac to build for the linudx/amd64 platform, which I did using the <code>--platform=linux/amd64</code> option to the FROM directive in my Dockerfile.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="kubernetes"><a class="header" href="#kubernetes">Kubernetes</a></h2>
<p>kubectl is a client wrapper around the k8s REST API.</p>
<p>Handy alias for kubectl: <code>k</code></p>
<pre><code>$ alias k='kubectl --kubeconfig ~/.kube/apprenticeship.tr-lab-chhq-1.yaml'

$ k config set-context --current --namespace=bg-helloworld-reference-impl-ns
</code></pre>
<p>Now I don't have to say &quot;-n bg-helloworld-reference-impl-ns&quot; after every command</p>
<pre><code># SSH to a running pod in a k8s cluster...

$ k get pods

NAME                           READY   STATUS    RESTARTS   AGE
codelabs-wl-77f89d845f-vr649   1/1     Running   0          24h

$ k get pod codelabs-wl-77f89d845f-vr649

$ k exec --stdin --tty codelabs-wl-77f89d845f-vr649 -- /bin/bash
</code></pre>
<p>See pod logs:</p>
<pre><code>$ k logs reference-helloworld-wl-597c5744b4-wbwsc --all-containers
</code></pre>
<p>kubectl keeps its config in <code>~/.kube/config</code>.  Some top-level config objects:</p>
<ul>
<li>A list of clusters</li>
<li>A list of users</li>
<li>A list of contexts</li>
<li>The current context</li>
<li>Preferences</li>
</ul>
<p>kubectl looking-around commands</p>
<pre><code>$ kubectl get pods
$ kubectl describe pod &lt;pod-id&gt;
$ kubectl get namespaces
$ kubectl config current-context
</code></pre>
<p>Miscellaneous debugging:</p>
<pre><code>$ kubectl config view   # See what kubectl thinks your config is
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="k8s-api-and-kubectl"><a class="header" href="#k8s-api-and-kubectl">k8s API and kubectl</a></h1>
<p>(This is digressing from cheat-sheet into tutorial territory, I know...)</p>
<p>Kubectl is a command-line wrapper around the <a href="https://kubernetes.io/docs/reference/kubernetes-api/">k8s REST API</a><sup class="footnote-reference"><a href="#what-is-rest">1</a></sup>, which is actually many API's organized into purpose-specific <strong>API Groups</strong>.  The list of <code>apiGroups</code> in an RBAC role definition's yaml corresponds to a component (aka &quot;GROUP path segment&quot;) of the REST URL.  For instance, this <code>ClusterRole</code> resource definition specifies rules for apis beginning with <code>/apis/apps</code>, <code>/apis/networking.k8s.io</code>, and <code>/api</code>.</p>
<pre><code>apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  # &quot;namespace&quot; is omitted since ClusterRoles are not namespaced; thus,
  # entities in various namespaces can be associated (or &quot;bound&quot;) to the app-deployer role.
  name: app-deployer
rules:
- apiGroups: [&quot;apps&quot;,&quot;networking.k8s.io&quot;,&quot;&quot;]
  # at the HTTP level, the name of the resource for accessing Secret objects is &quot;secrets&quot;
  resources: [&quot;pods&quot;, &quot;deployments&quot;, &quot;ingresses&quot;, &quot;secrets&quot;, &quot;services&quot;]
  # These correspond mostly to HTTP verbs, although k8s implements &quot;create&quot; and &quot;update&quot; with PUT
  verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;, &quot;patch&quot;, &quot;delete&quot;, &quot;create&quot;, &quot;update&quot;]
</code></pre>
<p>The <code>&quot;&quot;</code> entry represents the Core <code>apiGroup</code>, whose REST endpoints have no apiGroup component in their paths.  In the URL, as the <a href="k8s/%22https://kubernetes.io/docs/reference/using-api/api-concepts/%22">k8s api docs</a> put it,</p>
<blockquote>
<p>core resources use <code>/api</code> instead of <code>/apis</code> and omit the GROUP path segment.</p>
</blockquote>
<h2 id="calling-the-k8s-rest-api-directly-with-https"><a class="header" href="#calling-the-k8s-rest-api-directly-with-https">Calling the k8s REST API directly with HTTPS</a></h2>
<p>Let's be an HTTP client (like kubectl), and make HTTP REST calls to k8s with <code>curl</code>.</p>
<p><a href="https://iximiuz.com/en/posts/kubernetes-api-call-simple-http-client/">This post</a> has a pretty good walk-through.</p>
<p>How about getting info for a specific pod, as described in the k8s pod reference under <a href="https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#Operations">Operations</a>?</p>
<p>Assuming you have some pods running, first &quot;cheat&quot; and use kubectl to get a pod name, with <code>kubectl get pods</code>:</p>
<pre><code>kubectl get pods
NAME                                   READY   STATUS    RESTARTS   AGE
blue-helloworld-wl-84c98bfbdf-29hh7    1/1     Running   0          25h
green-helloworld-wl-7fd747c8cb-h5cnx   1/1     Running   0          26h
</code></pre>
<p>Now, using the API reference, let's construct a URL.  You'll need these pieces of info:</p>
<ul>
<li>The pod name</li>
<li>The namespace name</li>
<li>The base URL, which is your cluster's value of <code>server</code> in your <code>~/.kube/config</code>.  From there, tack on the reference's indicated URL path, beginning with <code>/apis</code>.  For instance...</li>
</ul>
<pre><code>https://047C9C71F223E20B1299471649359259.sk1.us-east-2.eks.amazonaws.com/api/v1/namespaces/appr-bg-hw-deploy-refimpl-ns/pods/blue-helloworld-wl-84c98bfbdf-29hh7
</code></pre>
<p>(Note that <code>pods</code> is a core API resource; we can tell because it uses <code>/api</code> instead of <code>/apis</code> in its REST path, and that path has no <code>apiGroup</code> component).</p>
<p>You'll also need an authorization token associated with your user or with a service account having sufficient permissions.</p>
<p>Postman is a great tool with which to poke at APIs.  I used it to generate this curl command (and appended <code>&gt; pod.json</code>):</p>
<pre><code>token=aLongAuthorizationTokenStringAssociatedWithYourServiceAccount
curl -s --header &quot;Authorization: Bearer $token&quot; --cacert /tmp/ap-dev-use2-1.crt https://047C9C71F223E20B1299471649359259.sk1.us-east-2.eks.amazonaws.com/api/v1/namespaces/appr-bg-hw-deploy-refimpl-ns/pods/blue-helloworld-wl-84c98bfbdf-29hh7 \
&gt; pod.json
</code></pre>
<p>Notice that I also passed a Certificate Authority (CA) cert into curl, so that it wouldn't fail with an SSL error.  This cert file came from the <code>certificate-authority-data</code> field in <code>~/.kube/config</code> for the cluster; because it's base64-encoded, it required decoding first:</p>
<pre><code>encoded_token=aLongCopyPastedCACertFromKubeSlashConfig
echo $encoded_token | base64 -d &gt; /tmp/ap-dev-use2-1.crt
</code></pre>
<p>(If you want to skip the SSL CA cert part, you can bypass <code>--cacert</code> and use the <code>-k</code> option instead).</p>
<p>You'll get back some JSON about the pod, saved into <code>pod.json</code>.  If you like, you can parse and filter it with <a href="https://jqlang.github.io/jq/tutorial">jq</a>...</p>
<pre><code>cat pod.json | jq '{state: .status.phase}'
&quot;Running&quot;
</code></pre>
<p><strong>Exercise for the reader</strong>: Go back to where we used kubectl to &quot;cheat&quot; and get a list of pods.  Instead of using kubectl, call the API directly with <code>curl</code> to get this list.</p>
<p>As a bonus, filter the JSON response with jq to print just the pod names.  Hover <a href="k8s/doesnotexist.jpg," title="cat pods.json| jq '.items[].metadata.name'">here</a> for a jq solution that prints pod names. Or <a href="k8s/doesnotexist.jpg," title="cat pods.json| jq '.items[] | {name: .metadata.name, state: .status.phase}'">here</a> for a jq solution that prints more attributes of each pod.</p>
<hr />
<p><sup class="footnote-reference"><a href="#what-is-rest">1</a></sup> - What is REST?  See Amazon AWS's <a href="https://aws.amazon.com/what-is/restful-api/">What Is A RESTful API?</a> for an overview.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="labels-selectors-annotations"><a class="header" href="#labels-selectors-annotations">Labels, Selectors, Annotations</a></h1>
<h2 id="labels"><a class="header" href="#labels">Labels</a></h2>
<h3 id="needed-for-gluing-k8s-resources-together"><a class="header" href="#needed-for-gluing-k8s-resources-together">Needed for gluing k8s resources together</a></h3>
<p>For instance, a <code>deployment</code> resource must define a label in its pod template metadata, so that a <code>service</code> resource can select pods by-label for routing traffic to them.</p>
<h3 id="handy-for-getting-organized---querying-diverse-k8s-resources-by-custom-label"><a class="header" href="#handy-for-getting-organized---querying-diverse-k8s-resources-by-custom-label">Handy for getting organized - querying diverse k8s resources by-custom-label</a></h3>
<p>For instance, a <code>pod</code> resource might belong to several categories of label:</p>
<pre><code>labels:
  app: guestbook
  tier: backend
  role: master
  environment: qa
</code></pre>
<p>You can query pods by-label like this:</p>
<pre><code># -l &lt;query&gt; - this one shows pods in production AND qa environments;
# -Lrole displays value of ROLE label as a column in the output
#
$ k get pods -l 'environment in (production,qa)' -Lrole
</code></pre>
<ul>
<li>Label prefixes (<code>some-prefix/some-label</code>) are optional.  Handy for avoiding naming conflicts</li>
<li>Label values can be empty</li>
<li>Total length must be 64 chars or less</li>
</ul>
<h2 id="selectors"><a class="header" href="#selectors">Selectors</a></h2>
<p><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#set-references-in-api-objects">Some Kubernetes objects, such as services and replicationcontrollers, also use label selectors to specify sets of other resources, such as pods.</a></p>
<p>Below is an example of a service selecting a pod by its <code>my-app</code> app label.</p>
<pre><code>---
apiVersion: apps/v1
kind: Deployment
spec:
  template:
    metadata:
      labels:
        app: my-app
...

---
apiVersion: v1
kind: Service
spec:
  selector:
    app: my-app
</code></pre>
<h2 id="annotations"><a class="header" href="#annotations">Annotations</a></h2>
<p>Annotations, unlike labels, are NOT used for resources queries.</p>
<h2 id="matchlabels-matchexpressions"><a class="header" href="#matchlabels-matchexpressions">matchLabels, matchExpressions</a></h2>
<p>For specifying set-based requirements in selectors.  Supported by newer resources (but not by <code>Service</code>, which supports <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#service-and-replicationcontroller">only equality-based selectors</a>).</p>
<h2 id="labels-and-selectors-in-deployment-manifests"><a class="header" href="#labels-and-selectors-in-deployment-manifests">Labels and Selectors in Deployment manifests</a></h2>
<p>Looking at deployment yaml, there are three different <code>labels</code> sections.  Their content often tends to be similar or identical, so it's puzzling why they live in so many places.  What are their purposes?</p>
<p>Consider this snippet of a typical Deployment yaml:</p>
<pre><code>apiVersion: apps/v1
kind: Deployment
metadata:
  ...
  labels:
    app: my-web-app
    app_env: development
  name: the-web-app
  namespace: the-web-app-ns
spec:
  selector:
    matchLabels:
      app: my-web-app
      app_env: development
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  template:
    metadata:
      labels:
        app: my-web-app
        app_env: development
    spec:
      containers:
      ...
</code></pre>
<p><code>labels</code> sections live in these places:</p>
<ol>
<li>The Deployment's metadata</li>
<li>The Deployment's spec.selector.matchLabels</li>
<li>The Deployment's spec.template.metadata</li>
</ol>
<h3 id="deployment-metadatalabels"><a class="header" href="#deployment-metadatalabels">Deployment metadata.labels</a></h3>
<p>The deployment's metadata.labels help with operations based on that deployment, e.g., deleting by querying with <code>-l</code> flag.</p>
<h3 id="deployment-specselectormatchlabels"><a class="header" href="#deployment-specselectormatchlabels">Deployment spec.selector.matchLabels</a></h3>
<p>A deployment uses the <code>matchLabels</code> selector to locate the pods itâ€™s responsible for managing.  If no pods with those labels when the deployment is first created, the deployment will do nothing. But if there are, the deployment will manage those pods.</p>
<h3 id="deployment-spectemplatemetadatalabels"><a class="header" href="#deployment-spectemplatemetadatalabels">Deployment spec.template.metadata.labels</a></h3>
<p>The pod template's metadata.labels are for creating pods that can be selected by a service for routing.</p>
<p>(The helpful explanation above was inspired by a <a href="https://www.goglides.dev/bkpandey/matchlabels-labels-and-selectors-in-deployment-5fk1">goglides.dev</a> post).</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="install-fly-the-concourse-ci-client"><a class="header" href="#install-fly-the-concourse-ci-client">Install <code>fly</code>, the Concourse-CI client</a></h2>
<pre><code>brew install fly
</code></pre>
<h2 id="authenticate-the-client-to-concourse"><a class="header" href="#authenticate-the-client-to-concourse">Authenticate the client to Concourse</a></h2>
<p><code>-t</code> is for target -- an alias to the set of credentials in <code>~/.flyrc</code> that will authenticate you to the Concourse instance you want to work with (or &quot;target&quot;).  <code>~/.flyrc</code> can store multiple sets of creds.</p>
<p>Since you have to specify target with every fly command, set up an alias...</p>
<pre><code>alias f=&quot;fly -t bg-hw-deploy-refimpl&quot;
</code></pre>
<p>Authentication is stored in <code>~/.flyrc</code>.</p>
<pre><code>f login --team-name devops-apprentices --concourse-url https://concourse.drw
f sync   # Update fly CLI version to match Concourse server.
</code></pre>
<h2 id="creating-and-activating-a-pipeline-in-concourse"><a class="header" href="#creating-and-activating-a-pipeline-in-concourse">Creating and activating a pipeline in Concourse</a></h2>
<pre><code>cd concourse
f set-pipeline -c pipeline.yml -p bg-hw-deploy-refimpl
f unpause-pipeline -p bg-hw-deploy-refimpl
</code></pre>
<h2 id="some-other-things-you-can-do-with-fly"><a class="header" href="#some-other-things-you-can-do-with-fly">Some other things you can do with fly</a></h2>
<pre><code>f targets
f status
f userinfo
f teams
f logout
f sync
f workers
f containers
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-vault-cli---reading-key-values"><a class="header" href="#the-vault-cli---reading-key-values">The Vault CLI - reading key-values</a></h1>
<p>Vault does a lot of things.  This page focuses on retrieving key-value pairs from a Vault &quot;secret&quot;.</p>
<h2 id="get-the-vault-cli"><a class="header" href="#get-the-vault-cli">Get the Vault CLI</a></h2>
<pre><code>sudo apt install vault
</code></pre>
<p>If the install fails, you may need to add the repository to your machine.</p>
<p>See:</p>
<ul>
<li><a href="https://learn.hashicorp.com/tutorials/vault/getting-started-install">Vault Getting Started</a></li>
<li><a href="https://www.hashicorp.com/blog/announcing-the-hashicorp-linux-repository">Announcing the Hashicorp Linux Repository</a></li>
</ul>
<h2 id="get-a-vault-token"><a class="header" href="#get-a-vault-token">Get a Vault token</a></h2>
<p>Assuming that ...</p>
<ol>
<li>You have Key-Values stored in a secret within a &quot;v2 Key-Value&quot; secrets engine on https://vault.mycompany.com (such as &quot;ansible&quot;), and</li>
<li>You belong to a group with access to that engine, and</li>
<li>Your group's policy lets you at least &quot;read&quot; and &quot;list&quot;,
...then when you obtain authentication token, you'll be able to read those KV's.</li>
</ol>
<pre><code>$ export VAULT_ADDR=https://vault.mycompany.com
$ export VAULT_NAMESPACE=unix
$ export VAULT_TOKEN=         # Make sure VAULT_TOKEN is not set, otherwise the Vault CLI will use it instead of ~/.vault-token
$ vault login -method=ldap username=$(id -un)
Password (will be hidden):
Success! You are now authenticated. The token information displayed below
is already stored in the token helper. You do NOT need to run &quot;vault login&quot;
again. Future Vault requests will automatically use this token.

Key                    Value
---                    -----
token                  s.EqpuvurstSkoL8Xtnst0OKkB
token_accessor         XMueQHm6hVr77sHLubc6Q5Az
token_duration         1h
token_renewable        true
token_policies         [&quot;default&quot;]
identity_policies      []
policies               [&quot;default&quot;]
token_meta_username    cwalquist
</code></pre>
<h2 id="use-the-token-for-vault-key-value-retrieval"><a class="header" href="#use-the-token-for-vault-key-value-retrieval">Use the token for Vault key-value retrieval</a></h2>
<h3 id="retrieve-with-curl"><a class="header" href="#retrieve-with-curl">Retrieve with curl</a></h3>
<p>One approach is to curl Vault, using the token for authentication.  This request returns a JSON bag of ALL the keys in the path (along with some metadata). jq is handy for parsing out what you need (in this case, the value of haproxy_license_key).</p>
<p>(Note the use of the Vault CLI to spit out a curl command).</p>
<pre><code>$ vault read -output-curl-string concourse/myteam/mydeploy

curl -H &quot;X-Vault-Namespace: unix/&quot; -H &quot;X-Vault-Token: $(vault print token)&quot; -H &quot;X-Vault-Request: true&quot; https://vault.mycompany.com/v1/concourse/myteam/mydeploy

# Add a &quot;-s&quot; to suppress extraneous curl output...
curl -s -H &quot;X-Vault-Namespace: unix/&quot; -H &quot;X-Vault-Token: $(vault print token)&quot; -H &quot;X-Vault-Request: true&quot; \
  https://vault.mycompany.com/v1/concourse/myteam/mydeploy \
  | jq .data.k8s_server_url

&quot;https://rancherqa.chhq.kube.mycompany.com/k8s/clusters/c-pwwrh&quot;
</code></pre>
<pre><code># Use the Vault CLI to spit out json format directly
$ vault read -format=json concourse/myteam/mydeploy \
  | jq .data.k8s_server_url
</code></pre>
<h3 id="retrieve-the-keys-value-with-the-vault-cli"><a class="header" href="#retrieve-the-keys-value-with-the-vault-cli">Retrieve the key's value with the Vault CLI</a></h3>
<pre><code>$ vault kv get -field k8s_server_url concourse/myteam/mydeploy
https://rancherqa.chhq.kube.mycompany.com/k8s/clusters/c-pwwrh
</code></pre>
<h3 id="concourse---retrieving-secrets-from-vault"><a class="header" href="#concourse---retrieving-secrets-from-vault">Concourse - Retrieving secrets from Vault</a></h3>
<p>In the <code>mydeploy</code> Concourse config, the git resource has a couple of references characterized by surrounding double-parens (( ... ))):</p>
<pre><code>...
  - name: mydeploy-app-repo
    type: git
    icon: github
    webhook_token: ((mydeploy.app_webhook_token))
    check_every: 4h
    source:
      uri: git@github.com:myorg/mydeploy.git
      private_key: ((mydeploy.app_private_deploy_key))
      branch: main
...
</code></pre>
<p>These are <a href="https://concourse-ci.org/vars.html#var-syntax">Concourse Vars</a>, referencing secrets in Vault.</p>
<p>Vault references are controlled by a <a href="https://concourse-ci.org/vars.html#cluster-wide-credential-manager">Concourse-cluster-wide credential manager</a>.  This excerpt is relevant:</p>
<blockquote>
<p>For credential managers like Vault that support path-based lookup, a secret-path without a leading / may be queried relative to a predefined set of path prefixes. This is how the Vault credential manager currently works; the key <code>foo</code> is expected under <code>/concourse/(team-name)/(pipeline-name)/foo</code>.</p>
</blockquote>
<p>So for example, Concourse keys for the <code>mydeploy</code> pipeline in the <code>myteam</code> Concourse team must live in the designated Vault namespace (such as <code>/unix</code>), under the <code>/concourse/myteam/mydeploy</code> path prefix at https://vault.mycompany.com.</p>
<p>More Vault info:</p>
<ul>
<li><a href="https://concourse-ci.org/vars.html#var-syntax">Referencing Vault Secrets with Concourse Vars</a></li>
</ul>
<p>For credential managers that support path-based lookup, a secret-path without a leading / may be queried relative to a predefined set of path prefixes. This is how the Vault credential manager currently works; foo will be queried under <code>/concourse/(team-name)/(pipeline-name)/foo</code>.</p>
<p>If you need to get hold of your cluster's CA chain, for purposes of configuring a k8s-resource in Concourse, https://technekey.com/how-to-get-kubernetes-ca-certificate/ has a one-liner ...</p>
<pre><code>$ kubectl config view --raw -o go-template='{{index ((index (index .clusters 0) &quot;cluster&quot;)) &quot;certificate-authority-data&quot;|base64decode}}'
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mac-os-x-keyboard-shortcuts-and-other-tipstricks"><a class="header" href="#mac-os-x-keyboard-shortcuts-and-other-tipstricks">Mac OS X keyboard shortcuts, and other tips/tricks</a></h1>
<p>(Install and start <a href="https://github.com/keycastr/keycastr">KeyCastr</a> if demo'ing keyboard shortcuts; shows keystrokes onscreen.)</p>
<h2 id="first-things"><a class="header" href="#first-things">First things...</a></h2>
<ul>
<li>âŒ˜-SPC (spacebar), &quot;sys&quot;, RETURN, and then search in System Settings for &quot;customize modifier&quot;</li>
<li>Map Caps Lock to ESC.  This will come in handy when you learn vim (you're going to learn Vim, of course ... ? ðŸ˜ƒ) Also, ESC cancels modal dialogs of various kinds, such as âŒ˜-SPC (Spotlight search).</li>
</ul>
<h3 id="in-system-settings-search-mission-choose-hot-corner-shortcuts"><a class="header" href="#in-system-settings-search-mission-choose-hot-corner-shortcuts">In System Settings, search &quot;mission&quot;, choose &quot;Hot Corner Shortcuts&quot;</a></h3>
<p><a href="https://support.apple.com/en-us/HT204100">Mission Control</a> - bird's-eye view of windows, spaces, and apps
I set my hot corners to something like this...
<img src="./img/hot-corners.png" alt="|200" /></p>
<p>When you touch that screen corner with your mouse, the selected action happens.</p>
<p>Other &quot;Mission Control&quot; settings:</p>
<ul>
<li>OFF - &quot;When switching to an app, switch to a space w/open windows&quot;</li>
<li>OFF - &quot;Displays have separate Spaces&quot;</li>
</ul>
<h2 id="general-keyboard-shortcuts"><a class="header" href="#general-keyboard-shortcuts">General Keyboard Shortcuts</a></h2>
<ul>
<li>
<p>âŒ˜-SPC - Spotlight. Search for anything on your Mac: apps, text, filenames, etc.</p>
<ul>
<li>What to search for?
<ul>
<li>&quot;ter&quot; - Terminal.app - Sometimes just &quot;t&quot; is enough; Spotlight remembers frequency.</li>
<li>&quot;sys&quot; - System Settings.app</li>
</ul>
</li>
</ul>
</li>
<li>
<p>âŒ˜-TAB - Cycle between open apps. (âŒ˜-SHFT-TAB goes the other way).</p>
</li>
<li>
<p>âŒ˜-n - New window in an app (e.g., new bash window in Terminal, new browser window in Chrome, new Finder window in Finder).</p>
</li>
<li>
<p>âŒ˜-w - Close active window in an app (e.g. a tab in your browser).</p>
</li>
<li>
<p>âŒ˜-` - Cycle between windows in an app.</p>
</li>
<li>
<p>âŒ˜-, - Open an app's settings (aka preferences).</p>
</li>
<li>
<p>âŒ˜-CTRL-SPC - Open the characters menu (emojis, symbols, etc.)</p>
</li>
</ul>
<h3 id="capturing-screenshots"><a class="header" href="#capturing-screenshots">Capturing Screenshots</a></h3>
<p><strong>Selecting and capturing a portion of the screen</strong></p>
<ul>
<li>âŒ˜-SHFT-4 - Drag the crosshair to select.  Selected area is saved in a file on your Desktop.</li>
<li>âŒ˜-SHFT-Ctrl-4 - Drag the crosshair to select.  Selected area is saved to your copy buffer (paste with âŒ˜-v).</li>
</ul>
<p><strong>Selecting and capturing a window</strong></p>
<ul>
<li>âŒ˜-SHFT-4, then SPC - When you tap SPC, the crosshair changes to a camera.  The active window is saved in a file on your Desktop.</li>
<li>âŒ˜-SHFT-Ctrl-4, then SPC - When you tap SPC, the crosshair changes to a camera.  The active window is saved to your copy buffer.</li>
</ul>
<h3 id="editing"><a class="header" href="#editing">Editing</a></h3>
<ul>
<li>âŒ˜-c - Copy selected</li>
<li>âŒ˜-v - Paste selected</li>
<li>âŒ˜-x - Delete selected</li>
<li>âŒ˜-z - Undo</li>
</ul>
<h2 id="app-specific-shortcuts"><a class="header" href="#app-specific-shortcuts">App-specific shortcuts</a></h2>
<h3 id="finder-shortcuts"><a class="header" href="#finder-shortcuts">Finder shortcuts</a></h3>
<ul>
<li>âŒ˜-SHFT-n - New folder at top of hierarchy in current Finder view.</li>
<li>âŒ˜-BKSPC - Delete highlighted item (e.g. a file).  BE CAREFUL!</li>
<li>&lt;right-arrow&gt; - Expand directory view.</li>
<li>âŒ˜-&lt;down-arrow&gt; - Zoom Finder view to highlighted sub-directory.</li>
<li>âŒ˜-&lt;up-arrow&gt; - Unzoom Finder view up on directory level.</li>
</ul>
<h3 id="browser-shortcuts"><a class="header" href="#browser-shortcuts">Browser shortcuts</a></h3>
<ul>
<li>âŒ˜-+ - Increase font size.</li>
<li>âŒ˜-MINUS - Decrease font size.</li>
<li>âŒ˜-0 - Restore default font size.</li>
<li>Ctrl-TAB - Cycle between tabs in active window.</li>
<li>You can drag a tab out into its own window (and drag it back in too).</li>
</ul>
<h3 id="mission-control---birds-eye-view-of-windows-spaces-and-apps"><a class="header" href="#mission-control---birds-eye-view-of-windows-spaces-and-apps"><a href="https://support.apple.com/en-us/HT204100">Mission Control</a> - bird's-eye view of windows, spaces, and apps</a></h3>
<ul>
<li>When in Mission Control, add a workspace with &quot;+&quot; (top right corner)</li>
<li>Ctrl-&lt;up-arrow&gt;</li>
<li>Ctrl-&lt;right-arrow&gt;, Ctrl-&lt;left-arrow&gt; - switch workspaces</li>
<li>Ctrl-&lt;down-arrow&gt; - app focus</li>
</ul>
<p>While in Mission Control, you can drag windows around to various desktops.</p>
<p>To delete a desktop, hover over its thumbnail until a white &quot;X&quot; appears, and click the &quot;X&quot;.  (No windows in that desktop will be deleted; they will simply move to the previous desktop).</p>
<p>Hit ESC to exit Mission Control.</p>
<h2 id="gestures"><a class="header" href="#gestures">Gestures</a></h2>
<p>In System Settings, search &quot;gestures&quot;, choose Trackpad gestures.</p>
<p>Trackpad with drag lock:</p>
<ul>
<li>&quot;use trackpad for dragging&quot;</li>
<li>&quot;with Drag Lock&quot;</li>
</ul>
<h3 id="terminalapp-zsh"><a class="header" href="#terminalapp-zsh">Terminal.app (zsh)</a></h3>
<ul>
<li>Tab to autocomplete file or directory names.</li>
<li>âŒ˜-k - Clear screen, including scrollback history.</li>
<li>âŒ˜-&lt;double-tap&gt; on a URL in the terminal window - Opens that URl in default browser.</li>
<li>âŒ˜-TAB - Open a new shell in the same window.
<ul>
<li>Ctrl-TAB - Cycle between tabs (similar to behavior with browser tabs).</li>
<li>You can drag a tab out into its own window (also like browser tab, except that you can't drag it back in).</li>
</ul>
</li>
</ul>
<h3 id="explore"><a class="header" href="#explore">Explore</a></h3>
<ul>
<li>Trackpad has &quot;light&quot; click and &quot;firm&quot; click (aka &quot;force click&quot;).</li>
<li>Function keys can be set to default to F1-12, or to the &quot;other&quot; mode (FN-&lt;fn-key&gt; accesses whatever the &quot;other&quot; mode is.  âŒ˜-SPC, &quot;function keys&quot;.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
